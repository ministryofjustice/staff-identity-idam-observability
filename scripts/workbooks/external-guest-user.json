{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "${tableName}",
        "size": 0,
        "timeContext": {
          "durationMs": 86400000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "/subscriptions/${subscriptionId}/resourceGroups/${resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/${workspaceName}"
        ]
      },
      "name": "query - 0"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let sub=toscalar(\r\n    ${tableName}\r\n    | where isNotActivatedAfterExternalPolicyDays == true\r\n    | summarize arg_max(objectid, *) by objectid\r\n    | count\r\n    );\r\nlet sub2=toscalar(\r\n    ${tableName}\r\n    | where isInactiveAfterExternalPolicyDays == true\r\n    | summarize arg_max(objectid, *) by objectid\r\n    | count\r\n    );\r\nlet totalGuests=toscalar(\r\n    ${tableName}\r\n    | summarize arg_max(objectid, *) by objectid\r\n    | count\r\n    );\r\nlet results = \r\nunion (print Name = \"Is Not Actived After External Policy Days\", Count = sub),\r\n(print Name = \"Is Inactive After External Policy Days\", Count = sub2),\r\n        (print Name = \"Total Guest Users\", Count = totalGuests);\r\nresults",
        "size": 0,
        "title": "Guest User Policy Status",
        "timeContext": {
          "durationMs": 86400000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "/subscriptions/${subscriptionId}/resourceGroups/${resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/${workspaceName}"
        ],
        "visualization": "barchart",
        "graphSettings": {
          "type": 0,
          "topContent": {
            "columnMatch": "Name",
            "formatter": 1
          },
          "centerContent": {
            "columnMatch": "Count",
            "formatter": 1,
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          }
        },
        "chartSettings": {
          "yAxis": [
            "Count"
          ],
          "group": "Name",
          "createOtherGroup": null
        }
      },
      "customWidth": "45",
      "name": "query - 1"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let sub=toscalar(\r\n    ${tableName}\r\n    | where externalUserState == \"PendingAcceptance\"\r\n    | summarize arg_max(objectid, *) by objectid\r\n    | count\r\n    );\r\nlet totalGuests=toscalar(\r\n    ${tableName}\r\n    | where externalUserState == \"Accepted\"\r\n    | summarize arg_max(objectid, *) by objectid\r\n    | count\r\n    );\r\nlet results = \r\nunion (print Name = \"Users Pending Acceptance\", Count = sub),\r\n        (print Name = \"Users Accepted\", Count = totalGuests);\r\nresults",
        "size": 0,
        "timeContext": {
          "durationMs": 86400000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "crossComponentResources": [
          "/subscriptions/${subscriptionId}/resourceGroups/${resourceGroup}/providers/Microsoft.OperationalInsights/workspaces/${workspaceName}"
        ],
        "visualization": "piechart",
        "graphSettings": {
          "type": 0,
          "topContent": {
            "columnMatch": "Name",
            "formatter": 1
          },
          "centerContent": {
            "columnMatch": "Count",
            "formatter": 1,
            "numberFormat": {
              "unit": 17,
              "options": {
                "maximumSignificantDigits": 3,
                "maximumFractionDigits": 2
              }
            }
          }
        },
        "chartSettings": {
          "yAxis": [
            "Count"
          ],
          "group": "Name",
          "createOtherGroup": null
        }
      },
      "customWidth": "45",
      "name": "query - 1 - Copy"
    }
  ],
  "fallbackResourceIds": [
    "azure monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
